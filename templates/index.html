<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í¬íŠ¸í´ë¦¬ì˜¤ ê³„ì‚°ê¸°</title>
  <script>
    async function runModel() {
      const fileInput = document.getElementById("file");
      const model = document.getElementById("model").value;
      const rebal = document.getElementById("rebal").value;
      const lookback = document.getElementById("lookback").value;

      if (!fileInput.files[0]) {
        alert("CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!");
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);
      formData.append("model", model);
      formData.append("rebal", rebal);
      formData.append("lookback", lookback);

      const resp = await fetch("/api/calculate", {
        method: "POST",
        body: formData
      });

      const data = await resp.json();

      // ì‘ë‹µ í™•ì¸
      console.log(data);

      // ê°€ì¤‘ì¹˜ í‘œì‹œ
      const weightsDiv = document.getElementById("weights");
      weightsDiv.textContent = JSON.stringify(data.weights, null, 2);

      // ëˆ„ì ìˆ˜ìµë¥  ê·¸ë˜í”„ í‘œì‹œ
      const plotImg = document.getElementById("plot");
      if (data.plot) {
        plotImg.src = "data:image/png;base64," + data.plot;
        plotImg.style.display = "block";
      } else {
        plotImg.style.display = "none";
      }

      // ë©”íŠ¸ë¦­ (ëˆ„ì ìˆ˜ìµë¥  ë§ˆì§€ë§‰ ê°’ ë“±)
      const cumret = data.cumret;
      if (cumret) {
        const lastValue = Object.values(cumret).slice(-1)[0];
        document.getElementById("metric").textContent =
          "ìµœì¢… ëˆ„ì ìˆ˜ìµë¥ : " + (lastValue * 100).toFixed(2) + "%";
      } else {
        document.getElementById("metric").textContent = "ë©”íŠ¸ë¦­ ì—†ìŒ";
      }
    }
  </script>
</head>
<body>
  <h2>ğŸ“ˆ í¬íŠ¸í´ë¦¬ì˜¤ ê³„ì‚°ê¸°</h2>

  <div>
    <label>CSV íŒŒì¼:</label>
    <input type="file" id="file" />
  </div>

  <div>
    <label>ëª¨ë¸:</label>
    <select id="model">
      <option value="MVP">Minimum Variance Portfolio</option>
      <option value="MaxSharpe">Mean-Variance (Max Sharpe)</option>
      <option value="RP">Risk Parity</option>
      <option value="MD">Maximize Diversification</option>
    </select>
  </div>

  <div>
    <label>ë¦¬ë°¸ëŸ°ìŠ¤ ì£¼ê¸°:</label>
    <input type="text" id="rebal" value="W-FRI" />
  </div>

  <div>
    <label>ë£©ë°± ê¸°ê°„:</label>
    <input type="number" id="lookback" value="60" />
  </div>

  <button onclick="runModel()">ê³„ì‚° ì‹¤í–‰</button>

  <hr />

  <h3>ğŸ“Š ê²°ê³¼</h3>
  <div><strong>ê°€ì¤‘ì¹˜:</strong></div>
  <pre id="weights" style="background:#f9f9f9; padding:10px; border-radius:8px;"></pre>

  <div><strong>ë©”íŠ¸ë¦­:</strong> <span id="metric"></span></div>

  <img id="plot" style="margin-top:20px; display:none; border:1px solid #ccc; border-radius:10px; max-width:700px;" />
</body>
</html>
